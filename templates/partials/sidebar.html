<!-- 
    SIDEBAR REUTILIZABLE
    
    Uso:

    Contexto requerido:
    - menu_items: Lista de diccionarios con estructura:
        [
            {
                'name': 'Dashboard',
                'icon': 'tachometer-alt',
                'url': 'core:dashboard',
                'active': True
            },
            {
                'name': 'Usuarios',
                'icon': 'users',
                'url': 'users:list',
                'active': False,
                'badge': 5  # Opcional
            },
            # Separador de sección
            {'separator': True, 'label': 'CONFIGURACIÓN'},
            ...
        ]
    
    Contexto opcional:
    - user: Usuario autenticado (para mostrar info)
-->

<!-- Sidebar principal -->
<aside id="sidebar-container"
    class="mode-docked fixed left-0 top-0 h-screen bg-gray-900/95 backdrop-blur-sm text-gray-100 flex flex-col z-60 border-r border-gray-800 shadow-xl">

    <!-- Resizer Handle (Docked Only) -->
    <div class="sidebar-resizer" title="Arrastrar para redimensionar"></div>

    <!-- Window Controls (Floating Only) -->
    <div class="window-controls">
        <button class="win-btn win-btn-close" onclick="sidebarAPI.dock()" aria-label="Acoplar"
            title="Acoplar a la izquierda">
            <i class="fas fa-times"></i>
        </button>
        <button class="win-btn win-btn-min" onclick="sidebarAPI.minimize()" aria-label="Minimizar"
            title="Minimizar a icono">
            <i class="fas fa-minus"></i>
        </button>
        <!-- Optional Maximize -->
        <button class="win-btn win-btn-max" onclick="sidebarAPI.dock()" aria-label="Expandir" title="Acoplar">
            <i class="fas fa-expand-alt"></i>
        </button>
    </div>

    <!-- Header: Logo + Undock Button -->
    <div class="flex items-center justify-between h-14 border-b border-gray-800 px-4 shrink-0">
        <div class="flex items-center gap-2.5 overflow-hidden">
            <!-- Undock Button (Visible only when docked via CSS) -->
            <button class="dock-only-btn text-gray-500 hover:text-white transition-colors" onclick="sidebarAPI.undock()"
                title="Desacoplar ventana">
                <i class="fas fa-columns text-lg transform rotate-180"></i>
            </button>
            <h1 class="text-base font-semibold tracking-tight whitespace-nowrap">UNEMI</h1>

            <!-- Mobile Close Button -->
            <button class="lg:hidden ml-4 text-gray-400 hover:text-white" onclick="sidebarAPI.toggleMobile(false)">
                <i class="fas fa-times"></i>
            </button>
        </div>



        <span class="text-[10px] text-gray-500 window-controls-hidden">v1.0</span>
    </div>

    <!-- Navegación principal -->
    <nav
        class="flex-1 overflow-y-auto py-4 px-3 scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-gray-800 cursor-default">
        <ul class="space-y-1">
            {% for item in menu_items %}
            {% if item.separator %}
            <!-- Separador de sección -->
            <li class="pt-4 pb-2 px-3">
                <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider block truncate">
                    {{ item.label }}
                </span>
            </li>
            {% else %}
            <!-- Item de menú -->
            <li>
                <a href="{{ item.url }}" class="group flex items-center justify-between px-3 py-2 rounded-sm transition-all duration-200
                                  {% if item.active %}
                                      bg-indigo-500/10 text-indigo-400 border-l-2 border-indigo-500 pl-2.5
                                  {% else %}
                                      text-gray-400 hover:bg-gray-800/50 hover:text-gray-200 border-l-2 border-transparent
                                  {% endif %}">
                    <div class="flex items-center gap-2.5 overflow-hidden">
                        <!-- Icono -->
                        <i
                            class="fas fa-{{ item.icon }} w-4 text-xs flex-shrink-0 text-center
                                          {% if item.active %}text-indigo-400{% else %}text-gray-500 group-hover:text-indigo-400{% endif %}">
                        </i>
                        <!-- Nombre -->
                        <span class="text-xs font-medium truncate">{{ item.name }}</span>
                    </div>

                    <!-- Badge opcional (contador) -->
                    {% if item.badge %}
                    <span class="ml-auto flex-shrink-0 px-1.5 py-0.5 text-[10px] font-semibold rounded-sm
                                           {% if item.active %}
                                               bg-indigo-500/20 text-indigo-300
                                           {% else %}
                                               bg-gray-700 text-gray-400 group-hover:bg-indigo-500/20 group-hover:text-indigo-300
                                           {% endif %}">
                        {{ item.badge }}
                    </span>
                    {% endif %}
                </a>
            </li>
            {% endif %}
            {% endfor %}
        </ul>
    </nav>

    <!-- NAS Health Section -->
    <div class="px-3 py-3 border-t border-gray-800 bg-gray-900/40">
        <div class="flex items-center justify-between mb-1">
            <span class="text-[9px] text-gray-400 font-bold uppercase tracking-widest">Almacenamiento NAS</span>
            <div class="flex items-center gap-1.5">
                {% if storage_status.is_online %}
                <span class="w-1.5 h-1.5 rounded-full bg-green-500 shadow-[0_0_5px_rgba(34,197,94,0.5)]"></span>
                <span class="text-[10px] text-green-500 font-bold">ONLINE</span>
                {% else %}
                <span
                    class="w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse shadow-[0_0_5px_rgba(239,68,68,0.5)]"></span>
                <span class="text-[10px] text-red-500 font-bold italic">OFFLINE</span>
                {% endif %}
            </div>
        </div>
        <p class="text-[9px] text-gray-500 leading-tight truncate" title="{{ storage_status.message }}">
            {{ storage_status.message }}
        </p>
    </div>

    <!-- Footer del sidebar -->
    <div class="border-t border-gray-800 p-3 bg-gray-800/50 shrink-0">
        {% if user.is_authenticated %}
        <div class="flex items-center gap-2.5 overflow-hidden">
            <!-- Avatar -->
            <div
                class="w-7 h-7 rounded-full bg-gradient-to-br from-pink-500 to-orange-500 flex flex-shrink-0 items-center justify-center text-white font-semibold text-[10px]">
                {{ user.username|slice:":2"|upper }}
            </div>
            <!-- Info del usuario -->
            <div class="flex-1 min-w-0">
                <p class="text-xs font-medium text-gray-300 truncate">{{ user.username|default:"Usuario" }}</p>
                <p class="text-[10px] text-gray-500 truncate">{{ user.email|default:"No email" }}</p>
            </div>
        </div>
        {% else %}
        <!-- Versión del sistema si no hay usuario -->
        <div class="text-center text-[10px] text-gray-500">
            <p>UNEMI CERTIFICADOS v1.0.0</p>
        </div>
        {% endif %}
    </div>

</aside>

<!-- Spacer para el contenido principal (evita que quede debajo del sidebar) -->
<div class="w-64"></div>